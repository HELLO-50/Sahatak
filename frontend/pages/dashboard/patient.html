<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patient Dashboard - Sahatak</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><path fill='%230d47a1' d='m8 2.748-.717-.737C5.6.281 2.514.878 1.4 3.053c-.523.942-.661 2.27.067 3.71L8 15.5l6.533-8.737c.728-1.44.59-2.768.067-3.71C13.486.878 10.4.28 8.717 2.01L8 2.748z'/></svg>">
    
    <!-- Bootstrap 5 CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    
    <!-- Bootstrap Icons CDN -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    <!-- Arabic Font - Noto Sans Arabic -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Main CSS -->
    <link rel="stylesheet" href="../../assets/css/main.css">
    <!-- Dashboard CSS -->
    <link rel="stylesheet" href="../../assets/css/components/dashboard.css">
    <!-- Video Consultation Dashboard CSS -->
    <link rel="stylesheet" href="../../assets/css/components/video-consultation-dashboard.css">
</head>
<body data-protect="patient">
    <div class="dashboard-container">
        <div class="container-fluid">
            <!-- Dashboard Header -->
            <div class="dashboard-header">
                <div class="row align-items-center">
                    <!-- Profile Section - Left (Right in RTL) -->
                    <div class="col-lg-4">
                        <div class="profile-section">
                            <div class="user-avatar">
                                <i class="bi bi-person-fill"></i>
                            </div>
                            <div class="user-details">
                                <h5 class="mb-1" id="user-name">Ahmed Mohamed</h5>
                            </div>
                            <!-- Vertical Action Buttons -->
                            <div class="action-buttons">
                                <button class="btn btn-action" onclick="showProfile()" title="Profile">
                                    <i class="bi bi-person"></i>
                                    <span id="btn-profile">Profile</span>
                                </button>
                                <button class="btn btn-action" onclick="showSettings()" title="Settings">
                                    <i class="bi bi-gear"></i>
                                    <span id="btn-settings">Settings</span>
                                </button>
                                <button class="btn btn-action btn-logout" onclick="AuthGuard.logout()" title="Logout">
                                    <i class="bi bi-box-arrow-right"></i>
                                    <span id="btn-logout">Logout</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Dashboard Title - Center -->
                    <div class="col-lg-4 text-center">
                        <h1 class="dashboard-title" id="dashboard-title">Patient Dashboard</h1>
                        <p class="dashboard-subtitle" id="dashboard-subtitle">Welcome to Sahatak Medical Platform</p>
                    </div>
                    
                    <!-- Language Selector - Right (Left in RTL) -->
                    <div class="col-lg-4 text-end">
                        <button class="btn btn-outline-medical btn-sm" onclick="showLanguageSelector()">
                            <i class="bi bi-globe me-1"></i>
                            <span id="current-lang">English</span>
                        </button>
                    </div>
                </div>
            </div>

            <div class="row">
                <!-- Main Content -->
                <div class="col-12">
                    <!-- Quick Actions -->
                    <div class="row mb-4">
                        <div class="col-lg-4 col-md-6 mb-3">
                            <div class="dashboard-card quick-action-card" onclick="bookAppointment()">
                                <div class="quick-action-icon">
                                    <i class="bi bi-plus-circle"></i>
                                </div>
                                <h6 id="action-book">Book New Appointment</h6>
                                <p class="text-muted small" id="action-book-desc">Schedule consultation with doctor</p>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-6 mb-3">
                            <div class="dashboard-card quick-action-card" onclick="viewRecords()">
                                <div class="quick-action-icon">
                                    <i class="bi bi-clipboard-data"></i>
                                </div>
                                <h6 id="action-records">My Medical Records</h6>
                                <p class="text-muted small" id="action-records-desc">View reports and results</p>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-6 mb-3">
                            <div class="dashboard-card quick-action-card" onclick="chatWithDoctor()">
                                <div class="quick-action-icon">
                                    <i class="bi bi-chat-dots"></i>
                                </div>
                                <h6 id="action-chat">Chat with Doctor</h6>
                                <p class="text-muted small" id="action-chat-desc">Text messages with doctor</p>
                            </div>
                        </div>
                    </div>

                    <!-- Statistics Row -->
                    <div class="row mb-4">
                        <div class="col-lg-4 col-md-6 mb-3">
                            <div class="dashboard-card stat-card">
                                <div class="stat-number" id="stat-appointments-count">-</div>
                                <div class="stat-label" id="stat-appointments">Scheduled Appointments</div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-6 mb-3">
                            <div class="dashboard-card stat-card">
                                <div class="stat-number" id="stat-prescriptions-count">-</div>
                                <div class="stat-label" id="stat-prescriptions">Active Prescriptions</div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-6 mb-3">
                            <div class="dashboard-card stat-card">
                                <div class="stat-number" id="stat-reports-count">-</div>
                                <div class="stat-label" id="stat-reports">Medical Reports</div>
                            </div>
                        </div>
                    </div>

                    <!-- Content Sections -->
                    <div class="row">
                        <!-- Upcoming Appointments -->
                        <div class="col-lg-6 mb-4">
                            <div class="dashboard-card">
                                <div id="appointments-container">
                                    <!-- Appointments will be loaded dynamically -->
                                    <div class="text-center py-4">
                                        <div class="spinner-border" role="status">
                                            <span class="visually-hidden">Loading...</span>
                                        </div>
                                        <p class="mt-2">Loading appointments...</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Health Summary -->
                        <div class="col-lg-6 mb-4">
                            <div class="dashboard-card">
                                <div id="health-summary-container">
                                    <!-- Health summary will be loaded dynamically -->
                                    <div class="text-center py-4">
                                        <div class="spinner-border" role="status">
                                            <span class="visually-hidden">Loading...</span>
                                        </div>
                                        <p class="mt-2">Loading health data...</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Active Prescriptions -->
                        <div class="col-lg-6 mb-4">
                            <div class="dashboard-card">
                                <div id="prescriptions-container">
                                    <!-- Prescriptions will be loaded dynamically -->
                                    <div class="text-center py-4">
                                        <div class="spinner-border" role="status">
                                            <span class="visually-hidden">Loading...</span>
                                        </div>
                                        <p class="mt-2">Loading prescriptions...</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Medical Records -->
                        <div class="col-lg-6 mb-4">
                            <div class="dashboard-card">
                                <div id="medical-records-container">
                                    <!-- Medical records will be loaded dynamically -->
                                    <div class="text-center py-4">
                                        <div class="spinner-border" role="status">
                                            <span class="visually-hidden">Loading...</span>
                                        </div>
                                        <p class="mt-2">Loading medical records...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- Profile Section (Hidden by default) -->
            <div id="profile-section" class="row mt-4" style="display: none;">
                <div class="col-12">
                    <div class="dashboard-card">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h5><i class="bi bi-person me-2"></i><span id="profile-title">Patient Profile</span></h5>
                            <button class="btn btn-outline-secondary btn-sm" onclick="hideProfile()">
                                <i class="bi bi-x-lg me-1"></i><span id="close-profile">Close</span>
                            </button>
                        </div>

                        <div class="row g-4">
                            <!-- Personal Information -->
                            <div class="col-lg-6">
                                <div class="settings-group">
                                    <h6 class="settings-group-title">
                                        <i class="bi bi-person-badge me-2"></i><span id="personal-info">Personal Information</span>
                                    </h6>
                                    
                                    <div class="mb-3">
                                        <label class="form-label fw-bold" id="label-patient-id">Patient ID</label>
                                        <p class="form-control-plaintext" id="patientId">PAT-2024-001</p>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label fw-bold" id="label-full-name">Full Name</label>
                                        <p class="form-control-plaintext" id="profileFullName">Ahmed Mohamed</p>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label fw-bold" id="label-email">Email Address</label>
                                        <p class="form-control-plaintext" id="profileEmail">ahmed.mohamed@example.com</p>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label fw-bold" id="label-phone">Phone Number</label>
                                        <input type="tel" class="form-control" id="profilePhone" placeholder="+249 123456789">
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label fw-bold" id="label-date-of-birth">Date of Birth</label>
                                        <p class="form-control-plaintext" id="profileDOB">15/03/1985</p>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label fw-bold" id="label-gender">Gender</label>
                                        <p class="form-control-plaintext" id="profileGender">Male</p>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label fw-bold" id="label-blood-type">Blood Type</label>
                                        <p class="form-control-plaintext" id="profileBloodType">O+</p>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label fw-bold" id="label-national-id">National ID</label>
                                        <p class="form-control-plaintext" id="profileNationalId">29503151234567</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Medical Information & Emergency Contact -->
                            <div class="col-lg-6">
                                <div class="settings-group">
                                    <h6 class="settings-group-title">
                                        <i class="bi bi-heart-pulse me-2"></i><span id="medical-info">Medical Information</span>
                                    </h6>
                                    
                                    <div class="mb-3">
                                        <label class="form-label fw-bold" id="label-allergies">Allergies</label>
                                        <p class="form-control-plaintext" id="profileAllergies">Penicillin, Pollen</p>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label fw-bold" id="label-chronic-conditions">Chronic Conditions</label>
                                        <p class="form-control-plaintext" id="profileChronicConditions">Hypertension, Diabetes Type 2</p>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label fw-bold" id="label-current-medications">Current Medications</label>
                                        <p class="form-control-plaintext" id="profileMedications">Metformin 500mg, Lisinopril 10mg</p>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label fw-bold" id="label-insurance-provider">Insurance Provider</label>
                                        <p class="form-control-plaintext" id="profileInsurance">Blue Cross Blue Shield</p>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label fw-bold" id="label-insurance-number">Insurance Number</label>
                                        <p class="form-control-plaintext" id="profileInsuranceNumber">INS-123456789</p>
                                    </div>

                                    <div class="settings-group mt-4">
                                        <h6 class="settings-group-title">
                                            <i class="bi bi-telephone me-2"></i><span id="emergency-contact">Emergency Contact</span>
                                        </h6>
                                        
                                        <div class="mb-3">
                                            <label class="form-label fw-bold">Contact Name</label>
                                            <p class="form-control-plaintext" id="emergencyName">Fatima Mohamed</p>
                                        </div>

                                        <div class="mb-3">
                                            <label class="form-label fw-bold">Relationship</label>
                                            <p class="form-control-plaintext" id="emergencyRelation">Wife</p>
                                        </div>

                                        <div class="mb-3">
                                            <label class="form-label fw-bold">Contact Phone</label>
                                            <p class="form-control-plaintext" id="emergencyPhone">+20 123 456 7891</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Account Information -->
                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="settings-group">
                                    <h6 class="settings-group-title">
                                        <i class="bi bi-info-circle me-2"></i><span id="account-info">Account Information</span>
                                    </h6>
                                    <div class="row">
                                        <div class="col-md-3">
                                            <label class="form-label fw-bold">Registration Date</label>
                                            <p class="form-control-plaintext" id="profileRegDate">01/01/2024</p>
                                        </div>
                                        <div class="col-md-3">
                                            <label class="form-label fw-bold">Last Login</label>
                                            <p class="form-control-plaintext" id="profileLastLogin">Today at 10:30 AM</p>
                                        </div>
                                        <div class="col-md-3">
                                            <label class="form-label fw-bold">Total Appointments</label>
                                            <p class="form-control-plaintext" id="profileTotalAppointments">24</p>
                                        </div>
                                        <div class="col-md-3">
                                            <label class="form-label fw-bold">Account Status</label>
                                            <p class="form-control-plaintext"><span class="badge bg-success">Active</span></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Edit Profile Button -->
                        <div class="text-end mt-4">
                            <button class="btn btn-primary" onclick="editProfile()">
                                <i class="bi bi-pencil me-1"></i><span id="edit-profile">Edit Profile</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Section (Hidden by default) -->
            <div id="settings-section" class="row mt-4" style="display: none;">
                <div class="col-12">
                    <div class="dashboard-card">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h5><i class="bi bi-gear me-2"></i><span id="settings-title">Settings</span></h5>
                            <button class="btn btn-outline-secondary btn-sm" onclick="hideSettings()">
                                <i class="bi bi-x-lg me-1"></i><span id="close-settings">Close</span>
                            </button>
                        </div>

                        <div class="row g-4">
                            <!-- Account Settings -->
                            <div class="col-lg-6">
                                <div class="settings-group">
                                    <h6 class="settings-group-title">
                                        <i class="bi bi-person-gear me-2"></i><span id="account-settings">Profile Information</span>
                                    </h6>
                                    
                                    <div class="mb-3">
                                        <label for="fullName" class="form-label" id="full-name-label">Full Name</label>
                                        <input type="text" class="form-control" id="fullName" placeholder="Enter your full name">
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="email" class="form-label" id="email-label">Email Address</label>
                                        <input type="email" class="form-control" id="email" placeholder="Enter your email">
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="phone" class="form-label" id="phone-label">Phone Number</label>
                                        <input type="tel" class="form-control" id="phone" placeholder="Enter your phone number">
                                    </div>

                                    <div class="mb-3">
                                        <label for="dateOfBirth" class="form-label" id="dob-label">Date of Birth</label>
                                        <input type="date" class="form-control" id="dateOfBirth">
                                    </div>

                                    <div class="mb-3">
                                        <label for="gender" class="form-label" id="gender-label">Gender</label>
                                        <select class="form-select" id="gender">
                                            <option value="">Select Gender</option>
                                            <option value="male">Male</option>
                                            <option value="female">Female</option>
                                            <option value="other">Other</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Preferences & Notifications -->
                            <div class="col-lg-6">
                                <div class="settings-group">
                                    <h6 class="settings-group-title">
                                        <i class="bi bi-bell me-2"></i><span id="preferences-settings">Preferences & Notifications</span>
                                    </h6>
                                    
                                    <div class="mb-3">
                                        <label for="language" class="form-label" id="language-label">Language</label>
                                        <select class="form-select" id="language">
                                            <option value="en">English</option>
                                            <option value="ar">العربية</option>
                                        </select>
                                    </div>

                                    <div class="mb-3">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="emailNotifications" checked>
                                            <label class="form-check-label" for="emailNotifications" id="email-notifications-label">
                                                Email Notifications
                                            </label>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="smsNotifications" checked>
                                            <label class="form-check-label" for="smsNotifications" id="sms-notifications-label">
                                                SMS Notifications
                                            </label>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="appointmentReminders" checked>
                                            <label class="form-check-label" for="appointmentReminders" id="appointment-reminders-label">
                                                Appointment Reminders
                                            </label>
                                        </div>
                                    </div>

                                    <div class="settings-group mt-4">
                                        <h6 class="settings-group-title">
                                            <i class="bi bi-shield-lock me-2"></i><span id="security-settings">Security</span>
                                        </h6>
                                        
                                        <div class="mb-3">
                                            <button class="btn btn-outline-primary btn-sm me-2" onclick="changePassword()">
                                                <i class="bi bi-key me-1"></i><span id="change-password">Change Password</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Save Settings Button -->
                        <div class="text-end mt-4">
                            <button class="btn btn-secondary me-2" onclick="resetSettings()">
                                <i class="bi bi-arrow-clockwise me-1"></i><span id="reset-settings">Reset</span>
                            </button>
                            <button class="btn btn-primary" onclick="saveSettings()">
                                <i class="bi bi-check-lg me-1"></i><span id="save-settings">Save Settings</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer mt-auto py-3">
        <div class="container">
            <div class="row g-3">
                <!-- Brand & Description -->
                <div class="col-lg-4 col-md-6">
                    <h5 class="mb-3">
                        <i class="bi bi-heart-pulse me-2 text-primary"></i>
                        <span id="footer-brand">Sahatak</span>
                    </h5>
                    <div class="d-flex gap-3 social-links">
                        <a href="https://facebook.com/sahatak" target="_blank" rel="noopener"><i class="bi bi-facebook fs-5"></i></a>
                        <a href="https://twitter.com/sahatak" target="_blank" rel="noopener"><i class="bi bi-twitter fs-5"></i></a>
                        <a href="https://instagram.com/sahatak" target="_blank" rel="noopener"><i class="bi bi-instagram fs-5"></i></a>
                        <a href="https://linkedin.com/company/sahatak" target="_blank" rel="noopener"><i class="bi bi-linkedin fs-5"></i></a>
                    </div>
                </div>

                <!-- Quick Links -->
                <div class="col-lg-2 col-md-6">
                    <h6 class="mb-3" id="footer-links-title">Quick Links</h6>
                    <ul class="list-unstyled">
                        <li class="mb-2">
                            <a href="../common/about.html" class="text-muted text-decoration-none" id="footer-about">About Platform</a>
                        </li>
                        <li class="mb-2">
                            <a href="../common/services.html" class="text-muted text-decoration-none" id="footer-services">Services</a>
                        </li>
                    </ul>
                </div>

                <!-- Support -->
                <div class="col-lg-3 col-md-6">
                    <h6 class="mb-3" id="footer-support-title">Support & Help</h6>
                    <ul class="list-unstyled">
                        <li class="mb-2">
                            <a href="../common/support.html" class="text-muted text-decoration-none" id="footer-help">Help Center</a>
                        </li>
                        <li class="mb-2">
                            <a href="../common/contact-us.html" class="text-muted text-decoration-none" id="footer-contact">Contact Us</a>
                        </li>
                    </ul>
                </div>

                <!-- Emergency Contact -->
                <div class="col-lg-3 col-md-6 emergency-section">
                    <p class="mb-2 text-danger fw-bold" id="footer-emergency-text">
                        For medical emergencies
                    </p>
                    <p class="mb-3 text-danger fw-bold fs-6" id="footer-emergency-action">
                        <i class="bi bi-hospital me-2"></i>
                        Go to nearest ER hospital
                    </p>
                    <p class="mb-0 text-muted small" id="footer-emergency-note">
                        For non-urgent consultations use the platform
                    </p>
                </div>
            </div>

            <!-- Bottom Bar -->
            <hr class="my-3">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0 fw-bold" id="footer-copyright">
                        © 2025 Sahatak. All rights reserved.
                    </p>
                    <p class="mb-0 text-muted small mt-1" id="footer-medical-disclaimer">
                        This platform does not replace visiting a doctor in emergency cases
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap 5 JavaScript CDN -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    
    <!-- Authentication Guard (must load first) -->
    <script src="../../assets/js/components/auth-guard.js"></script>
    <script src="../../assets/js/components/session-manager.js"></script>
    
    <!-- Main JavaScript -->
    <script src="../../assets/js/main.js"></script>
    
    <!-- Dashboard Translations -->
    <script src="../../assets/js/components/dashboard-translations.js"></script>
    
    <!-- Dashboard Data Handler -->
    <script src="../../assets/js/components/dashboard.js"></script>
    
    <!-- Video Consultation Dashboard JavaScript -->
    <script src="../../assets/js/components/video-consultation-dashboard.js"></script>
    
    <!-- Dashboard JavaScript -->
    <script>
        // Dashboard specific functions
        function bookAppointment() {
            console.log('Book appointment clicked');
            window.location.href = '../appointments/book-appointment.html';
        }
        
        function viewPastAppointments() {
            console.log('View past appointments clicked');
            window.location.href = '../appointments/appointment-list.html';
        }
        
        function viewRecords() {
            console.log('View records clicked');
            window.location.href = '../medical/patient/index.html';
        }
        
        function chatWithDoctor() {
            console.log('Chat with doctor clicked');
            window.location.href = '../medical/patient/comm-hub.html';
        }
        
        function showLanguageSelector() {
            console.log('Language selector clicked');
            // Toggle between Arabic and English
            const currentLang = LanguageManager.getLanguage() || 'ar';
            const newLang = currentLang === 'ar' ? 'en' : 'ar';
            
            // Change language
            LanguageManager.setLanguage(newLang);
            LanguageManager.applyLanguage(newLang);
            
            // Update dashboard translations (call after applyLanguage to ensure footer is properly updated)
            if (DashboardTranslations && DashboardTranslations.updatePatientDashboard) {
                DashboardTranslations.updatePatientDashboard(newLang);
            }
            
            // Update the language button text
            const langBtn = document.getElementById('current-lang');
            langBtn.textContent = newLang === 'ar' ? 'العربية' : 'English';
        }
        
        function showProfile() {
            console.log('Show profile clicked');
            const profileSection = document.getElementById('profile-section');
            const settingsSection = document.getElementById('settings-section');
            
            // Hide settings if open
            settingsSection.style.display = 'none';
            
            // Toggle profile
            profileSection.style.display = profileSection.style.display === 'none' ? 'block' : 'none';
            
            // Smooth scroll to profile section
            if (profileSection.style.display === 'block') {
                profileSection.scrollIntoView({ behavior: 'smooth' });
                loadUserProfile();
                
                // Update translations for profile section
                const currentLang = LanguageManager.getLanguage() || 'ar';
                const translations = LanguageManager.translations[currentLang];
                if (translations && translations.dashboard && translations.dashboard.patient && translations.dashboard.patient.profile) {
                    DashboardTranslations.updateProfileAndSettings(translations.dashboard.patient.profile, null);
                }
            }
        }

        function hideProfile() {
            document.getElementById('profile-section').style.display = 'none';
        }

        function loadUserProfile() {
            // Load user profile from localStorage or API
            const user = JSON.parse(localStorage.getItem('sahatak_user_data') || '{}');
            
            // Personal Information
            document.getElementById('profileFullName').textContent = user.full_name || 'Ahmed Mohamed';
            document.getElementById('profileEmail').textContent = user.email || 'ahmed.mohamed@example.com';
            document.getElementById('profilePhone').textContent = user.phone || '+20 123 456 7890';
            document.getElementById('profileDOB').textContent = user.date_of_birth || '15/03/1985';
            document.getElementById('profileGender').textContent = user.gender || 'Male';
            document.getElementById('profileBloodType').textContent = user.blood_type || 'O+';
            document.getElementById('profileNationalId').textContent = user.national_id || '29503151234567';
            document.getElementById('patientId').textContent = user.patient_id || 'PAT-2024-001';
            
            // Medical Information
            document.getElementById('profileAllergies').textContent = user.allergies || 'Penicillin, Pollen';
            document.getElementById('profileChronicConditions').textContent = user.chronic_conditions || 'Hypertension, Diabetes Type 2';
            document.getElementById('profileMedications').textContent = user.current_medications || 'Metformin 500mg, Lisinopril 10mg';
            document.getElementById('profileInsurance').textContent = user.insurance_provider || 'Blue Cross Blue Shield';
            document.getElementById('profileInsuranceNumber').textContent = user.insurance_number || 'INS-123456789';
            
            // Emergency Contact
            document.getElementById('emergencyName').textContent = user.emergency_name || 'Fatima Mohamed';
            document.getElementById('emergencyRelation').textContent = user.emergency_relation || 'Wife';
            document.getElementById('emergencyPhone').textContent = user.emergency_phone || '+20 123 456 7891';
            
            // Account Information
            document.getElementById('profileRegDate').textContent = user.registration_date || '01/01/2024';
            document.getElementById('profileLastLogin').textContent = user.last_login || 'Today at 10:30 AM';
            document.getElementById('profileTotalAppointments').textContent = user.total_appointments || '24';
        }

        function editProfile() {
            // Switch to settings section for editing
            hideProfile();
            showSettings();
            alert('Please use the Settings section to edit your profile information.');
        }

        function showSettings() {
            console.log('Show settings clicked');
            const settingsSection = document.getElementById('settings-section');
            const profileSection = document.getElementById('profile-section');
            
            // Hide profile if open
            profileSection.style.display = 'none';
            
            // Toggle settings
            settingsSection.style.display = settingsSection.style.display === 'none' ? 'block' : 'none';
            
            // Smooth scroll to settings section
            if (settingsSection.style.display === 'block') {
                settingsSection.scrollIntoView({ behavior: 'smooth' });
                loadUserSettings();
                
                // Update translations for settings section
                const currentLang = LanguageManager.getLanguage() || 'ar';
                const translations = LanguageManager.translations[currentLang];
                if (translations && translations.dashboard && translations.dashboard.patient && translations.dashboard.patient.settings) {
                    DashboardTranslations.updateProfileAndSettings(null, translations.dashboard.patient.settings);
                }
            }
        }

        function hideSettings() {
            document.getElementById('settings-section').style.display = 'none';
        }

        function loadUserSettings() {
            // Load user settings from localStorage (simulating database)
            const user = JSON.parse(localStorage.getItem('sahatak_user_data') || '{}');
            
            // If no data exists, set default values (simulating initial database load)
            if (!user.full_name) {
                user.full_name = 'Ahmed Mohamed';
                user.email = 'ahmed.mohamed@example.com';
                user.phone = '+20 123 456 7890';
                user.date_of_birth = '1985-03-15';
                user.gender = 'male';
                localStorage.setItem('sahatak_user_data', JSON.stringify(user));
            }
            
            // Populate form fields with current values from database
            document.getElementById('fullName').value = user.full_name || '';
            document.getElementById('email').value = user.email || '';
            document.getElementById('phone').value = user.phone || '';
            document.getElementById('dateOfBirth').value = user.date_of_birth || '';
            document.getElementById('gender').value = user.gender || '';
            
            // Load preferences from database
            const preferences = JSON.parse(localStorage.getItem('sahatak_preferences') || '{}');
            document.getElementById('language').value = preferences.language || 'en';
            document.getElementById('emailNotifications').checked = preferences.email_notifications !== false;
            document.getElementById('smsNotifications').checked = preferences.sms_notifications !== false;
            document.getElementById('appointmentReminders').checked = preferences.appointment_reminders !== false;
        }

        function saveSettings() {
            // Get current data from database
            const currentUser = JSON.parse(localStorage.getItem('sahatak_user_data') || '{}');
            const currentPrefs = JSON.parse(localStorage.getItem('sahatak_preferences') || '{}');
            
            // Collect only changed fields
            const updatedUser = {
                ...currentUser,
                full_name: document.getElementById('fullName').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                date_of_birth: document.getElementById('dateOfBirth').value,
                gender: document.getElementById('gender').value
            };
            
            // Update preferences
            const updatedPrefs = {
                language: document.getElementById('language').value,
                email_notifications: document.getElementById('emailNotifications').checked,
                sms_notifications: document.getElementById('smsNotifications').checked,
                appointment_reminders: document.getElementById('appointmentReminders').checked
            };
            
            // Save to database (localStorage simulating database)
            localStorage.setItem('sahatak_user_data', JSON.stringify(updatedUser));
            localStorage.setItem('sahatak_preferences', JSON.stringify(updatedPrefs));
            
            // Update displayed name in header if changed
            if (updatedUser.full_name !== currentUser.full_name) {
                document.getElementById('user-name').textContent = updatedUser.full_name;
            }
            
            // Show success message with changes
            const changedFields = [];
            if (currentUser.full_name !== updatedUser.full_name) changedFields.push('Name');
            if (currentUser.email !== updatedUser.email) changedFields.push('Email');
            if (currentUser.phone !== updatedUser.phone) changedFields.push('Phone');
            
            if (changedFields.length > 0) {
                alert(`Settings saved successfully!\nUpdated: ${changedFields.join(', ')}`);
            } else {
                alert('Settings saved successfully!');
            }
            
            console.log('Settings saved:', updatedUser, updatedPrefs);
            
            // Refresh profile section if it's open
            if (document.getElementById('profile-section').style.display !== 'none') {
                loadUserProfile();
            }
        }

        function resetSettings() {
            if (confirm('Are you sure you want to reload settings from database?')) {
                // Reload original values from database
                loadUserSettings();
                alert('Settings reloaded from database.');
            }
        }

        function changePassword() {
            alert('Password change functionality will redirect to secure password update page.');
        }

        function enableTwoFactor() {
            alert('Two-factor authentication setup will be implemented.');
        }
        
        function viewAllAppointments() {
            console.log('View all appointments clicked');
            window.location.href = '../appointments/appointment-list.html';
        }
        
        // logout function is now defined globally in main.js
        
        // Initialize patient dashboard on page load
        // Load dashboard statistics from API
        async function loadDashboardStats() {
            console.log('Loading dashboard statistics...');
            
            try {
                // Load appointments to count scheduled ones
                const appointmentsResponse = await ApiHelper.makeRequest('/appointments/');
                
                if (appointmentsResponse.success) {
                    const appointments = appointmentsResponse.data.appointments;
                    
                    // Get upcoming appointments for display (including today's appointments)
                    const now = new Date();
                    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate()); // Start of today
                    
                    console.log('🔍 Patient appointments received:', appointments);
                    
                    const upcomingAppointments = appointments.filter(apt => {
                        const isValidStatus = ['scheduled', 'confirmed'].includes(apt.status);
                        const aptDate = new Date(apt.appointment_date);
                        const isUpcoming = aptDate >= today; // Include today's appointments
                        
                        console.log(`📅 Patient appointment ${apt.id}: ${apt.appointment_date}, status: ${apt.status}, valid: ${isValidStatus}, upcoming: ${isUpcoming}`);
                        return isValidStatus && isUpcoming;
                    }).sort((a, b) => new Date(a.appointment_date) - new Date(b.appointment_date));
                    
                    // Update appointment counter
                    document.getElementById('stat-appointments-count').textContent = upcomingAppointments.length;
                    
                    // Update appointments list with matching color scheme from doctor.html
                    const appointmentsContainer = document.getElementById('appointments-container');
                    if (appointmentsContainer) {
                        if (upcomingAppointments.length > 0) {
                            appointmentsContainer.innerHTML = `
                                <h5 class="mb-3">
                                    <i class="bi bi-calendar-day me-2"></i>
                                    Upcoming Appointments
                                </h5>
                                ${upcomingAppointments.slice(0, 3).map(apt => {
                                    const appointmentDate = new Date(apt.appointment_date);
                                    const dateStr = appointmentDate.toLocaleDateString('en-US', { 
                                        weekday: 'short', 
                                        month: 'short', 
                                        day: 'numeric' 
                                    });
                                    const timeStr = appointmentDate.toLocaleTimeString('en-US', { 
                                        hour: 'numeric', 
                                        minute: '2-digit',
                                        hour12: true 
                                    });
                                    
                                    // Add video consultation class if video appointment
                                    const videoClass = apt.appointment_type === 'video' ? 'appointment-card video-appointment' : 'appointment-card';
                                    
                                    // Generate video consultation button if applicable
                                    const videoButton = VideoConsultationDashboard.generateVideoConsultationButton(apt);
                                    
                                    return `
                                        <div class="${videoClass}" data-appointment-id="${apt.id}">
                                            <div class="appointment-item d-flex justify-content-between align-items-center p-2 mb-2 bg-light rounded">
                                                <div>
                                                    <div style="color: black;"><strong>${apt.doctor_name || 'Unknown Doctor'}</strong></div>
                                                    <div class="text-muted small">
                                                        <i class="bi ${apt.appointment_type === 'video' ? 'bi-camera-video' : 'bi-calendar-check'} me-1"></i>${apt.appointment_type}
                                                    </div>
                                                    ${apt.reason_for_visit ? `<div class="text-muted small">${apt.reason_for_visit}</div>` : ''}
                                                    <div class="small" style="color: darkgreen;">
                                                        <i class="bi bi-calendar me-1"></i>${dateStr} ${timeStr}
                                                    </div>
                                                    ${videoButton ? `<div class="mt-2">${videoButton}</div>` : ''}
                                                </div>
                                                <span class="badge bg-primary">${apt.status}</span>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                                <div class="text-center mt-3">
                                    <button class="btn btn-outline-primary btn-sm" onclick="viewPastAppointments()">
                                        <i class="bi bi-calendar-check me-1"></i>
                                        <span id="btn-view-past">${LanguageManager?.translate('appointments.view_past_appointments') || 'View Past Appointments'}</span>
                                    </button>
                                </div>
                            `;
                        } else {
                            appointmentsContainer.innerHTML = `
                                <h5 class="mb-3">
                                    <i class="bi bi-calendar-day me-2"></i>
                                    Upcoming Appointments
                                </h5>
                                <p class="text-muted text-center py-3">No upcoming appointments</p>
                                <div class="text-center mt-3">
                                    <button class="btn btn-outline-primary btn-sm" onclick="viewPastAppointments()">
                                        <i class="bi bi-calendar-check me-1"></i>
                                        <span id="btn-view-past">${LanguageManager?.translate('appointments.view_past_appointments') || 'View Past Appointments'}</span>
                                    </button>
                                </div>
                            `;
                        }
                    }
                    
                    console.log(`Updated appointment counter: ${upcomingAppointments.length}`);
                } else {
                    console.warn('Failed to load appointments for stats:', appointmentsResponse.message);
                    document.getElementById('stat-appointments-count').textContent = '0';
                }
            } catch (error) {
                console.error('Error loading dashboard stats:', error);
                document.getElementById('stat-appointments-count').textContent = '-';
            }
            
            try {
                // Load prescriptions count from API
                const prescriptionsResponse = await ApiHelper.makeRequest('/prescriptions/');
                
                if (prescriptionsResponse.success) {
                    const prescriptions = prescriptionsResponse.data.prescriptions || [];
                    
                    // Count active prescriptions
                    const activeCount = prescriptions.filter(prescription => 
                        prescription.status === 'active'
                    ).length;
                    
                    document.getElementById('stat-prescriptions-count').textContent = activeCount;
                    console.log(`Updated prescriptions counter: ${activeCount}`);
                } else {
                    console.warn('Failed to load prescriptions for stats:', prescriptionsResponse.message);
                    document.getElementById('stat-prescriptions-count').textContent = '0';
                }
            } catch (error) {
                console.error('Error loading prescriptions stats:', error);
                document.getElementById('stat-prescriptions-count').textContent = '-';
            }
            
            try {
                // Load medical history/reports count from API
                const currentUser = AuthGuard.getCurrentUser();
                if (currentUser && currentUser.id) {
                    const historyResponse = await ApiHelper.makeRequest(`/medical-history/patient/${currentUser.id}`);
                    
                    if (historyResponse.success) {
                        const historyData = historyResponse.data;
                        
                        // Count medical reports/records (appointments with diagnosis, lab results, etc.)
                        let reportCount = 0;
                        if (historyData.appointments) {
                            reportCount += historyData.appointments.filter(apt => 
                                apt.diagnosis || apt.prescription || apt.notes
                            ).length;
                        }
                        if (historyData.vital_signs) {
                            reportCount += historyData.vital_signs.length;
                        }
                        if (historyData.lab_results) {
                            reportCount += historyData.lab_results.length;
                        }
                        
                        document.getElementById('stat-reports-count').textContent = reportCount;
                        console.log(`Updated medical reports counter: ${reportCount}`);
                    } else {
                        console.warn('Failed to load medical history for stats:', historyResponse.message);
                        document.getElementById('stat-reports-count').textContent = '0';
                    }
                } else {
                    console.warn('No current user found for medical history stats');
                    document.getElementById('stat-reports-count').textContent = '0';
                }
            } catch (error) {
                // For 403 errors (new users), show 0 instead of error
                if (error.statusCode === 403) {
                    console.log('Medical history not accessible yet (new user) - showing 0');
                    document.getElementById('stat-reports-count').textContent = '0';
                } else {
                    console.error('Error loading medical reports stats:', error);
                    document.getElementById('stat-reports-count').textContent = '0';
                }
            }
        }
        
        // Refresh dashboard statistics - can be called from other pages
        window.refreshDashboardStats = function() {
            console.log('Refreshing dashboard statistics...');
            loadDashboardStats();
        };

        document.addEventListener('DOMContentLoaded', async function() {
            console.log('Patient dashboard initializing...');
            await DashboardTranslations.initializeDashboard('patient');
            
            // Load dashboard statistics after translations are loaded
            setTimeout(() => {
                loadDashboardStats();
            }, 1000); // Small delay to ensure API is ready
        });
    </script>
</body>
</html>