<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doctor Dashboard - Sahatak</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><path fill='%230d47a1' d='m8 2.748-.717-.737C5.6.281 2.514.878 1.4 3.053c-.523.942-.661 2.27.067 3.71L8 15.5l6.533-8.737c.728-1.44.59-2.768.067-3.71C13.486.878 10.4.28 8.717 2.01L8 2.748z'/></svg>">
    
    <!-- Bootstrap 5 CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    
    <!-- Bootstrap Icons CDN -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    <!-- Arabic Font - Noto Sans Arabic -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Main CSS -->
    <link rel="stylesheet" href="../../assets/css/main.css">
    <!-- Dashboard CSS -->
    <link rel="stylesheet" href="../../assets/css/components/dashboard.css">
    <style>
        /* Unverified doctor states */
        .unverified-disabled {
            opacity: 0.5;
            cursor: not-allowed !important;
            pointer-events: none;
        }
        
        .verification-overlay {
            position: relative;
        }
        
        .verification-overlay::after {
            content: "ðŸ”’ Verification Required";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            color: #dc3545;
            border: 1px solid #dc3545;
            z-index: 10;
            display: none;
        }
        
        .unverified-disabled.verification-overlay::after {
            display: block;
        }
        
        .verification-notice {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
        }
        
        .verification-notice .notice-icon {
            color: #856404;
            font-size: 24px;
        }
    </style>
</head>
<body data-protect="doctor">
    <div class="dashboard-container">
        <div class="container-fluid">
            <!-- Dashboard Header -->
            <div class="dashboard-header">
                <div class="row align-items-center">
                    <!-- Profile Section - Left (Right in RTL) -->
                    <div class="col-lg-4">
                        <div class="profile-section">
                            <div class="user-avatar">
                                <i class="bi bi-person-badge"></i>
                            </div>
                            <div class="user-details">
                                <h5 class="mb-1" id="user-name">Loading...</h5>
                                <span class="badge bg-warning text-dark" id="verification-status">Unverified</span>
                            </div>
                            <!-- Vertical Action Buttons -->
                            <div class="action-buttons">
                                <button class="btn btn-action" onclick="showProfile()" title="Profile">
                                    <i class="bi bi-person"></i>
                                    <span id="btn-profile">Profile</span>
                                </button>
                                <button class="btn btn-action" onclick="showSettings()" title="Settings">
                                    <i class="bi bi-gear"></i>
                                    <span id="btn-settings">Settings</span>
                                </button>
                                <button class="btn btn-action btn-logout" onclick="AuthGuard.logout()" title="Logout">
                                    <i class="bi bi-box-arrow-right"></i>
                                    <span id="btn-logout">Logout</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Dashboard Title - Center -->
                    <div class="col-lg-4 text-center">
                        <h1 class="dashboard-title" id="dashboard-title">Doctor Dashboard</h1>
                        <p class="dashboard-subtitle" id="dashboard-subtitle">Manage Patients and Medical Consultations</p>
                    </div>
                    
                    <!-- Controls - Right (Left in RTL) -->
                    <div class="col-lg-4 text-end">
                        <div class="dashboard-controls">
                            <button class="btn btn-outline-medical btn-sm" onclick="toggleAvailability()">
                                <i class="bi bi-circle-fill text-success me-1"></i>
                                <span id="availability-status">Available</span>
                            </button>
                            <button class="btn btn-outline-medical btn-sm" onclick="showLanguageSelector()">
                                <i class="bi bi-globe me-1"></i>
                                <span id="current-lang">English</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Verification Notice (Hidden by default, shown for unverified doctors) -->
            <div id="verification-notice" class="row" style="display: none;">
                <div class="col-12">
                    <div class="verification-notice">
                        <div class="d-flex align-items-center">
                            <i class="bi bi-shield-exclamation notice-icon me-3"></i>
                            <div class="flex-grow-1">
                                <h6 class="mb-1 text-warning-emphasis" id="notice-title">Account Verification Required</h6>
                                <p class="mb-0 text-muted" id="notice-message">
                                    Your doctor account needs to be verified before you can access patient consultations and manage appointments. 
                                    Please complete your profile and wait for admin approval.
                                </p>
                            </div>
                            <button class="btn btn-outline-warning btn-sm" onclick="showProfile()">
                                <i class="bi bi-person-check me-1"></i>
                                <span id="complete-profile">Complete Profile</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <!-- Main Content -->
                <div class="col-12">
                    <!-- Quick Actions -->
                    <div class="row mb-4">
                        <div class="col-lg-4 col-md-6 mb-3">
                            <div id="communication-card" class="dashboard-card quick-action-card verification-overlay" onclick="handleVerifiedAction('openCommunicationHub')">
                                <div class="quick-action-icon">
                                    <i class="bi bi-chat-dots"></i>
                                </div>
                                <h6 id="action-communication">Patient Communication</h6>
                                <p class="text-muted small" id="action-communication-desc">Message and connect with patients</p>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-6 mb-3">
                            <div id="records-card" class="dashboard-card quick-action-card verification-overlay" onclick="handleVerifiedAction('reviewRecords')">
                                <div class="quick-action-icon">
                                    <i class="bi bi-file-medical"></i>
                                </div>
                                <h6 id="action-records">Review Records</h6>
                                <p class="text-muted small" id="action-records-desc">View patient files</p>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-6 mb-3">
                            <div id="availability-card" class="dashboard-card quick-action-card verification-overlay" onclick="handleVerifiedAction('manageAvailability')">
                                <div class="quick-action-icon">
                                    <i class="bi bi-calendar-week"></i>
                                </div>
                                <h6 id="action-schedule">Manage Availability</h6>
                                <p class="text-muted small" id="action-schedule-desc">Set available hours and block time slots</p>
                            </div>
                        </div>
                    </div>


                    <!-- Content Sections -->
                    <div class="row">
                        <!-- Today's Schedule -->
                        <div class="col-lg-6 mb-4">
                            <div id="schedule-card" class="dashboard-card verification-overlay">
                                <h5 id="schedule-title">
                                    <i class="bi bi-calendar-day me-2"></i>
                                    Today's Schedule
                                </h5>
                                <div id="appointments-container">
                                    <!-- Appointments will be loaded dynamically -->
                                </div>
                                <div class="text-center mt-3">
                                    <button class="btn btn-outline-medical" onclick="handleVerifiedAction('viewFullSchedule')">
                                        <span id="view-full-schedule">View Full Schedule</span>
                                        <i class="bi bi-arrow-right ms-1"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Quick Statistics -->
                        <div class="col-lg-6 mb-4">
                            <div id="stats-card" class="dashboard-card verification-overlay">
                                <h5 id="quick-stats-title">
                                    <i class="bi bi-graph-up me-2"></i>
                                    Quick Statistics
                                </h5>
                                <div id="doctor-stats-container">
                                    <!-- Doctor statistics will be loaded dynamically -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Waiting Patients & Recent Activity -->
                    <div class="row">
                        <!-- Waiting Patients -->
                        <div class="col-lg-6 mb-4">
                            <div id="waiting-card" class="dashboard-card verification-overlay">
                                <h5 id="waiting-title">
                                    <i class="bi bi-hourglass-split me-2"></i>
                                    Patients Waiting for Response
                                </h5>
                                <div id="waiting-patients-container">
                                    <!-- Waiting patients will be loaded dynamically -->
                                </div>
                                <div class="text-center mt-3">
                                    <button class="btn btn-outline-medical" onclick="handleVerifiedAction('viewAllMessages')">
                                        <span id="view-all-messages">View All Messages</span>
                                        <i class="bi bi-arrow-right ms-1"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Recent Activity -->
                        <div class="col-lg-6 mb-4">
                            <div id="activity-card" class="dashboard-card verification-overlay">
                                <h5 id="activity-title">
                                    <i class="bi bi-activity me-2"></i>
                                    Recent Activity
                                </h5>
                                <div id="recent-activity-container">
                                    <!-- Recent activity will be loaded dynamically -->
                                </div>
                                <div class="text-center mt-3">
                                    <button class="btn btn-outline-medical" onclick="handleVerifiedAction('viewAllActivity')">
                                        <span id="view-all-activity">View All Activities</span>
                                        <i class="bi bi-arrow-right ms-1"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

            <!-- Profile Section (Hidden by default) -->
            <div id="profile-section" class="row mt-4" style="display: none;">
                <div class="col-12">
                    <div class="dashboard-card">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h5><i class="bi bi-person me-2"></i><span id="profile-title">Doctor Profile</span></h5>
                            <button class="btn btn-outline-secondary btn-sm" onclick="hideProfile()">
                                <i class="bi bi-x-lg me-1"></i><span id="close-profile">Close</span>
                            </button>
                        </div>

                        <div class="row g-4">
                            <!-- Personal Information -->
                            <div class="col-lg-6">
                                <div class="settings-group">
                                    <h6 class="settings-group-title">
                                        <i class="bi bi-person-badge me-2"></i><span id="personal-info">Personal Information</span>
                                    </h6>
                                    
                                    <div class="mb-3">
                                        <label class="form-label fw-bold" id="label-doctor-id">Doctor ID</label>
                                        <p class="form-control-plaintext" id="doctorId">DOC-2024-001</p>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label fw-bold" id="label-full-name">Full Name</label>
                                        <p class="form-control-plaintext" id="profileFullName">Dr. Sarah Ahmed</p>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label fw-bold" id="label-email">Email Address</label>
                                        <p class="form-control-plaintext" id="profileEmail">sarah.ahmed@sahatak.com</p>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label fw-bold" id="label-phone">Phone Number</label>
                                        <div class="row g-2">
                                            <div class="col-md-4">
                                                <select class="form-select" id="profilePhoneCountry">
                                                    <option value="" id="select-country">Select Country</option>
                                                    <option value="SD" id="country-sudan">ðŸ‡¸ðŸ‡© Sudan (+249)</option>
                                                    <option value="EG" id="country-egypt">ðŸ‡ªðŸ‡¬ Egypt (+20)</option>
                                                    <option value="SA" id="country-saudi">ðŸ‡¸ðŸ‡¦ Saudi Arabia (+966)</option>
                                                    <option value="AE" id="country-uae">ðŸ‡¦ðŸ‡ª UAE (+971)</option>
                                                    <option value="IE" id="country-ireland">ðŸ‡®ðŸ‡ª Ireland (+353)</option>
                                                    <option value="US" id="country-usa">ðŸ‡ºðŸ‡¸ United States (+1)</option>
                                                    <option value="GB" id="country-uk">ðŸ‡¬ðŸ‡§ United Kingdom (+44)</option>
                                                </select>
                                            </div>
                                            <div class="col-md-8">
                                                <input type="tel" class="form-control" id="profilePhone" placeholder="123456789">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label fw-bold" id="label-medical-license">Medical License Number</label>
                                        <p class="form-control-plaintext" id="profileMedicalLicense">ML-2019-12345</p>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label fw-bold" id="label-specialization">Specialization</label>
                                        <p class="form-control-plaintext" id="profileSpecialization">Internal Medicine</p>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label fw-bold" id="label-experience">Years of Experience</label>
                                        <input type="number" class="form-control" id="profileExperience" min="0" max="60">
                                    </div>
                                </div>
                            </div>

                            <!-- Professional Information -->
                            <div class="col-lg-6">
                                <div class="settings-group">
                                    <h6 class="settings-group-title">
                                        <i class="bi bi-hospital me-2"></i><span id="professional-info">Professional Information</span>
                                    </h6>
                                    
                                    <div class="mb-3">
                                        <label class="form-label fw-bold" id="label-hospital-affiliations">Hospital Affiliations</label>
                                        <input type="text" class="form-control" id="profileHospitals" placeholder="e.g., Cairo Medical Center, Al-Azhar Hospital">
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label fw-bold" id="label-department">Department</label>
                                        <input type="text" class="form-control" id="profileDepartment" placeholder="e.g., Internal Medicine">
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label fw-bold" id="label-consultation-fee">Consultation Fee (EGP)</label>
                                        <input type="number" class="form-control" id="profileFee" min="0" placeholder="300">
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label fw-bold" id="label-education-details">Education Details</label>
                                        <textarea class="form-control" id="profileEducation" rows="3" placeholder="List your medical degrees, universities, and graduation years"></textarea>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label fw-bold" id="label-certifications">Certifications</label>
                                        <input type="text" class="form-control" id="profileCertifications" placeholder="e.g., Board Certified Internal Medicine">
                                        <small class="text-muted">Separate multiple certifications with commas</small>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label fw-bold" id="label-memberships">Professional Memberships</label>
                                        <input type="text" class="form-control" id="profileMemberships" placeholder="e.g., Sudan Medical Association">
                                        <small class="text-muted">Separate multiple memberships with commas</small>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label fw-bold" id="label-languages">Languages Spoken</label>
                                        <input type="text" class="form-control" id="profileLanguages" placeholder="e.g., Arabic, English, French">
                                        <small class="text-muted">List all languages you can consult in</small>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label fw-bold" id="label-consultation-areas">Consultation Areas</label>
                                        <input type="text" class="form-control" id="profileConsultationAreas" placeholder="e.g., General Medicine, Diabetes Management">
                                        <small class="text-muted">Your areas of expertise</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Contact Information -->
                        <div class="row mt-4">
                            <div class="col-lg-6">
                                <div class="settings-group">
                                    <h6 class="settings-group-title">
                                        <i class="bi bi-telephone me-2"></i><span id="contact-info">Contact Information</span>
                                    </h6>
                                    
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Office Phone</label>
                                        <input type="tel" class="form-control" id="profileOfficePhone" placeholder="+249 xx xxx xxxx">
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Emergency Contact</label>
                                        <input type="tel" class="form-control" id="profileEmergencyContact" placeholder="+249 xx xxx xxxx">
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Office Address</label>
                                        <textarea class="form-control" id="profileOfficeAddress" rows="2" placeholder="Enter your clinic or hospital address"></textarea>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-lg-6">
                                <div class="settings-group">
                                    <h6 class="settings-group-title">
                                        <i class="bi bi-file-earmark-medical me-2"></i><span id="documents-info">Documents & Verification</span>
                                    </h6>
                                    
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Medical License Document</label>
                                        <input type="file" class="form-control" id="profileLicenseDoc" accept=".pdf,.jpg,.jpeg,.png">
                                        <small class="text-muted">PDF, JPG, PNG (Max 5MB)</small>
                                        <div class="upload-status mt-1" id="license-upload-status"></div>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Medical Degree Document</label>
                                        <input type="file" class="form-control" id="profileDegreeDoc" accept=".pdf,.jpg,.jpeg,.png">
                                        <small class="text-muted">PDF, JPG, PNG (Max 5MB)</small>
                                        <div class="upload-status mt-1" id="degree-upload-status"></div>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label fw-bold">National ID/Passport</label>
                                        <input type="file" class="form-control" id="profileIdDoc" accept=".pdf,.jpg,.jpeg,.png">
                                        <small class="text-muted">PDF, JPG, PNG (Max 5MB)</small>
                                        <div class="upload-status mt-1" id="id-upload-status"></div>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Other Documents (Optional)</label>
                                        <input type="file" class="form-control" id="profileOtherDocs" accept=".pdf,.jpg,.jpeg,.png" multiple>
                                        <small class="text-muted">Additional certifications or relevant documents</small>
                                        <div class="upload-status mt-1" id="other-upload-status"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Additional Information -->
                        <div class="row mt-4">
                            <div class="col-lg-6">
                                <div class="settings-group">
                                    <h6 class="settings-group-title">
                                        <i class="bi bi-clock me-2"></i><span id="schedule-info">Schedule & Availability</span>
                                    </h6>
                                    
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Consultation Hours</label>
                                        <div class="form-control-plaintext" id="profileConsultationHours">
                                            <div>Sunday - Thursday: 9:00 AM - 5:00 PM</div>
                                            <div>Friday: 9:00 AM - 2:00 PM</div>
                                            <div>Saturday: Closed</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-lg-6">
                                <div class="settings-group">
                                    <h6 class="settings-group-title">
                                        <i class="bi bi-graph-up me-2"></i><span id="stats-info">Statistics</span>
                                    </h6>
                                    
                                    <div class="row">
                                        <div class="col-6">
                                            <label class="form-label fw-bold">Total Patients</label>
                                            <p class="form-control-plaintext" id="profileTotalPatients">1,250</p>
                                        </div>
                                        <div class="col-6">
                                            <label class="form-label fw-bold">Total Consultations</label>
                                            <p class="form-control-plaintext" id="profileTotalConsultations">3,890</p>
                                        </div>
                                        <div class="col-6">
                                            <label class="form-label fw-bold">Rating</label>
                                            <p class="form-control-plaintext" id="profileRating">4.8/5.0</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Account Information -->
                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="settings-group">
                                    <h6 class="settings-group-title">
                                        <i class="bi bi-info-circle me-2"></i><span id="account-info">Account Information</span>
                                    </h6>
                                    <div class="row">
                                        <div class="col-md-3">
                                            <label class="form-label fw-bold">Registration Date</label>
                                            <p class="form-control-plaintext" id="profileRegDate">15/06/2019</p>
                                        </div>
                                        <div class="col-md-3">
                                            <label class="form-label fw-bold">Last Login</label>
                                            <p class="form-control-plaintext" id="profileLastLogin">Today at 9:15 AM</p>
                                        </div>
                                        <div class="col-md-3">
                                            <label class="form-label fw-bold">Account Status</label>
                                            <p class="form-control-plaintext"><span class="badge bg-success">Active</span></p>
                                        </div>
                                        <div class="col-md-3">
                                            <label class="form-label fw-bold">Verification Status</label>
                                            <p class="form-control-plaintext"><span class="badge bg-primary">Verified</span></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Profile Action Buttons -->
                        <div class="text-end mt-4">
                            <button class="btn btn-secondary me-2" onclick="loadUserProfile()">
                                <i class="bi bi-arrow-clockwise me-1"></i><span id="reset-profile">Reset Changes</span>
                            </button>
                            <button class="btn btn-primary" onclick="saveProfile()">
                                <i class="bi bi-check-lg me-1"></i><span id="save-profile">Save Profile</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Section (Hidden by default) -->
            <div id="settings-section" class="row mt-4" style="display: none;">
                <div class="col-12">
                    <div class="dashboard-card">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h5><i class="bi bi-gear me-2"></i><span id="settings-title">Settings</span></h5>
                            <button class="btn btn-outline-secondary btn-sm" onclick="hideSettings()">
                                <i class="bi bi-x-lg me-1"></i><span id="close-settings">Close</span>
                            </button>
                        </div>

                        <div class="row g-4">
                            <!-- Account Settings -->
                            <div class="col-lg-6">
                                <div class="settings-group">
                                    <h6 class="settings-group-title">
                                        <i class="bi bi-person-gear me-2"></i><span id="account-settings">Profile Information</span>
                                    </h6>
                                    
                                    <div class="mb-3">
                                        <label for="fullName" class="form-label" id="full-name-label">Full Name</label>
                                        <input type="text" class="form-control" id="fullName" placeholder="Enter your full name">
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="email" class="form-label" id="email-label">Email Address</label>
                                        <input type="email" class="form-control" id="email" placeholder="Enter your email">
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="phone" class="form-label" id="phone-label">Phone Number</label>
                                        <input type="tel" class="form-control" id="phone" placeholder="Enter your phone number">
                                    </div>

                                    <div class="mb-3">
                                        <label for="medicalLicense" class="form-label" id="medical-license-label">Medical License Number</label>
                                        <input type="text" class="form-control" id="medicalLicense" placeholder="Enter your medical license number">
                                    </div>

                                    <div class="mb-3">
                                        <label for="specialization" class="form-label" id="specialization-label">Specialization</label>
                                        <select class="form-select" id="specialization">
                                            <option value="">Select Specialization</option>
                                            <option value="cardiology">Cardiology</option>
                                            <option value="neurology">Neurology</option>
                                            <option value="orthopedics">Orthopedics</option>
                                            <option value="pediatrics">Pediatrics</option>
                                            <option value="psychiatry">Psychiatry</option>
                                            <option value="surgery">Surgery</option>
                                            <option value="internal-medicine">Internal Medicine</option>
                                            <option value="dermatology">Dermatology</option>
                                            <option value="ophthalmology">Ophthalmology</option>
                                            <option value="other">Other</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Preferences & Notifications -->
                            <div class="col-lg-6">
                                <div class="settings-group">
                                    <h6 class="settings-group-title">
                                        <i class="bi bi-bell me-2"></i><span id="preferences-settings">Preferences & Notifications</span>
                                    </h6>
                                    
                                    <div class="mb-3">
                                        <label for="language" class="form-label" id="language-label">Language</label>
                                        <select class="form-select" id="language">
                                            <option value="en">English</option>
                                            <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                                        </select>
                                    </div>

                                    <div class="mb-3">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="emailNotifications" checked>
                                            <label class="form-check-label" for="emailNotifications" id="email-notifications-label">
                                                Email Notifications
                                            </label>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="smsNotifications" checked>
                                            <label class="form-check-label" for="smsNotifications" id="sms-notifications-label">
                                                SMS Notifications
                                            </label>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="appointmentReminders" checked>
                                            <label class="form-check-label" for="appointmentReminders" id="appointment-reminders-label">
                                                Appointment Reminders
                                            </label>
                                        </div>
                                    </div>

                                    <div class="settings-group mt-4">
                                        <h6 class="settings-group-title">
                                            <i class="bi bi-shield-lock me-2"></i><span id="security-settings">Security</span>
                                        </h6>
                                        
                                        <div class="mb-3">
                                            <button class="btn btn-outline-primary btn-sm me-2" onclick="changePassword()">
                                                <i class="bi bi-key me-1"></i><span id="change-password">Change Password</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Save Settings Button -->
                        <div class="text-end mt-4">
                            <button class="btn btn-secondary me-2" onclick="resetSettings()">
                                <i class="bi bi-arrow-clockwise me-1"></i><span id="reset-settings">Reset</span>
                            </button>
                            <button class="btn btn-primary" onclick="saveSettings()">
                                <i class="bi bi-check-lg me-1"></i><span id="save-settings">Save Settings</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

    <!-- Footer -->
    <footer class="footer mt-auto py-3">
        <div class="container">
            <div class="row g-3">
                <!-- Brand & Description -->
                <div class="col-lg-4 col-md-6">
                    <h5 class="mb-3">
                        <i class="bi bi-heart-pulse me-2 text-primary"></i>
                        <span id="footer-brand">Sahatak</span>
                    </h5>
                    <div class="d-flex gap-3 social-links">
                        <a href="https://facebook.com/sahatak" target="_blank" rel="noopener"><i class="bi bi-facebook fs-5"></i></a>
                        <a href="https://twitter.com/sahatak" target="_blank" rel="noopener"><i class="bi bi-twitter fs-5"></i></a>
                        <a href="https://instagram.com/sahatak" target="_blank" rel="noopener"><i class="bi bi-instagram fs-5"></i></a>
                        <a href="https://linkedin.com/company/sahatak" target="_blank" rel="noopener"><i class="bi bi-linkedin fs-5"></i></a>
                    </div>
                </div>

                <!-- Quick Links -->
                <div class="col-lg-2 col-md-6">
                    <h6 class="mb-3" id="footer-links-title">Quick Links</h6>
                    <ul class="list-unstyled">
                        <li class="mb-2">
                            <a href="../common/about.html" class="text-muted text-decoration-none" id="footer-about">About Platform</a>
                        </li>
                        <li class="mb-2">
                            <a href="../common/services.html" class="text-muted text-decoration-none" id="footer-services">Services</a>
                        </li>
                    </ul>
                </div>

                <!-- Support -->
                <div class="col-lg-3 col-md-6">
                    <h6 class="mb-3" id="footer-support-title">Support & Help</h6>
                    <ul class="list-unstyled">
                        <li class="mb-2">
                            <a href="../common/support.html" class="text-muted text-decoration-none" id="footer-help">Help Center</a>
                        </li>
                        <li class="mb-2">
                            <a href="../common/contact-us.html" class="text-muted text-decoration-none" id="footer-contact">Contact Us</a>
                        </li>
                    </ul>
                </div>

                <!-- Emergency Contact -->
                <div class="col-lg-3 col-md-6 emergency-section">
                    <p class="mb-2 text-danger fw-bold" id="footer-emergency-text">
                        For medical emergencies
                    </p>
                    <p class="mb-3 text-danger fw-bold fs-6" id="footer-emergency-action">
                        <i class="bi bi-hospital me-2"></i>
                        Go to nearest ER hospital
                    </p>
                    <p class="mb-0 text-muted small" id="footer-emergency-note">
                        For non-urgent consultations use the platform
                    </p>
                </div>
            </div>

            <!-- Bottom Bar -->
            <hr class="my-3">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0 fw-bold" id="footer-copyright">
                        Â© 2025 Sahatak. All rights reserved.
                    </p>
                    <p class="mb-0 text-muted small mt-1" id="footer-medical-disclaimer">
                        This platform does not replace visiting a doctor in emergency cases
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap 5 JavaScript CDN -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    
    <!-- Authentication Guard (must load first) -->
    <script src="../../assets/js/components/auth-guard.js"></script>
    <script src="../../assets/js/components/session-manager.js"></script>
    
    <!-- Main JavaScript -->
    <script src="../../assets/js/main.js"></script>
    
    <!-- Dashboard Translations -->
    <script src="../../assets/js/components/dashboard-translations.js"></script>
    
    <!-- Dashboard JavaScript -->
    <script src="../../assets/js/components/dashboard.js"></script>
    
    <!-- Doctor Dashboard JavaScript -->
    <script>
        // Doctor dashboard specific functions
        function openCommunicationHub() {
            console.log('Communication Hub clicked');
            window.location.href = '../medical/doctor/comm-hub.html';
        }
        
        function reviewRecords() {
            console.log('Review records clicked');
            window.location.href = '../medical/doctor/ehr.html';
        }
        
        function manageAvailability() {
            console.log('Manage availability clicked');
            window.location.href = '../medical/doctor/setAvailability.html';
        }
        
        function showProfile() {
            console.log('Show profile clicked');
            const profileSection = document.getElementById('profile-section');
            const settingsSection = document.getElementById('settings-section');
            
            // Hide settings if open
            settingsSection.style.display = 'none';
            
            // Toggle profile
            profileSection.style.display = profileSection.style.display === 'none' ? 'block' : 'none';
            
            // Smooth scroll to profile section
            if (profileSection.style.display === 'block') {
                profileSection.scrollIntoView({ behavior: 'smooth' });
                loadUserProfile();
                
                // Update translations for profile section
                const currentLang = LanguageManager.getLanguage() || 'ar';
                const translations = LanguageManager.translations[currentLang];
                if (translations && translations.dashboard && translations.dashboard.doctor && translations.dashboard.doctor.profile) {
                    DashboardTranslations.updateProfileAndSettings(translations.dashboard.doctor.profile, null);
                }
            }
        }

        function hideProfile() {
            document.getElementById('profile-section').style.display = 'none';
        }

        function updateVerificationStatus(user) {
            console.log('updateVerificationStatus called with user:', user);
            console.log('user.is_verified:', user.is_verified);
            console.log('user.verification_status:', user.verification_status);
            
            const statusElement = document.getElementById('verification-status');
            const isVerified = user.is_verified === true || user.verification_status === 'verified';
            
            console.log('Calculated isVerified:', isVerified);
            
            if (isVerified) {
                statusElement.textContent = 'Verified';
                statusElement.className = 'badge bg-success';
                console.log('Setting status to Verified');
                // Enable all dashboard functionality
                enableDashboardActions();
            } else {
                statusElement.textContent = 'Unverified';
                statusElement.className = 'badge bg-warning text-dark';
                console.log('Setting status to Unverified');
                // Disable dashboard functionality and show notice
                disableDashboardActions();
            }
        }

        function enableDashboardActions() {
            // Hide verification notice
            document.getElementById('verification-notice').style.display = 'none';
            
            // Enable all action cards
            const actionCards = [
                'communication-card', 'records-card', 'availability-card',
                'schedule-card', 'stats-card', 'waiting-card', 'activity-card'
            ];
            
            actionCards.forEach(cardId => {
                const card = document.getElementById(cardId);
                if (card) {
                    card.classList.remove('unverified-disabled');
                }
            });
        }

        function disableDashboardActions() {
            // Show verification notice
            document.getElementById('verification-notice').style.display = 'block';
            
            // Disable all action cards
            const actionCards = [
                'communication-card', 'records-card', 'availability-card',
                'schedule-card', 'stats-card', 'waiting-card', 'activity-card'
            ];
            
            actionCards.forEach(cardId => {
                const card = document.getElementById(cardId);
                if (card) {
                    card.classList.add('unverified-disabled');
                }
            });
        }

        function handleVerifiedAction(actionFunction) {
            // Get user data from localStorage which contains verification status
            const user = JSON.parse(localStorage.getItem('sahatak_doctor_data') || '{}');
            console.log('handleVerifiedAction - user from localStorage:', user);
            console.log('handleVerifiedAction - user.is_verified:', user.is_verified);
            const isVerified = user && (user.is_verified === true || user.verification_status === 'verified');
            console.log('handleVerifiedAction - isVerified:', isVerified);
            
            if (!isVerified) {
                // Show verification required message
                console.log('handleVerifiedAction - showing verification required modal');
                showVerificationRequiredModal();
                return;
            }
            
            // Execute the action if verified
            console.log('handleVerifiedAction - executing action:', actionFunction);
            if (typeof window[actionFunction] === 'function') {
                window[actionFunction]();
            } else {
                console.warn(`Function ${actionFunction} not found`);
            }
        }

        function showVerificationRequiredModal() {
            // Use translation system for verification required message
            const currentLang = LanguageManager.getLanguage() || 'ar';
            const message = LanguageManager.getTranslation(currentLang, 'dashboard.doctor.verification_notice.verification_required_action') ||
                'Your account must be verified first to access this feature. Please complete your profile and wait for admin approval.';
            
            alert(message);
        }

        function loadUserProfile() {
            // Load user profile from localStorage or API
            const user = JSON.parse(localStorage.getItem('sahatak_doctor_data') || '{}');
            
            // Update verification status in header
            updateVerificationStatus(user);
            
            // Personal Information (display-only fields)
            document.getElementById('profileFullName').textContent = user.full_name || 'Dr. Sarah Ahmed';
            document.getElementById('profileEmail').textContent = user.email || 'sarah.ahmed@sahatak.com';
            document.getElementById('profilePhone').textContent = user.phone || '+20 123 456 7890';
            document.getElementById('profileMedicalLicense').textContent = user.medical_license || 'ML-2019-12345';
            document.getElementById('profileSpecialization').textContent = user.specialization || 'Internal Medicine';
            document.getElementById('doctorId').textContent = user.doctor_id || 'DOC-2024-001';
            
            // Editable Professional Information
            document.getElementById('profileExperience').value = user.experience || '';
            document.getElementById('profileHospitals').value = user.hospital_affiliations || '';
            document.getElementById('profileDepartment').value = user.department || '';
            document.getElementById('profileFee').value = user.consultation_fee || '';
            document.getElementById('profileEducation').value = user.education_details || '';
            document.getElementById('profileCertifications').value = user.certifications || '';
            document.getElementById('profileMemberships').value = user.memberships || '';
            document.getElementById('profileLanguages').value = user.languages || '';
            document.getElementById('profileConsultationAreas').value = user.consultation_areas || '';
            
            // Contact Information
            document.getElementById('profileOfficePhone').value = user.office_phone || '';
            document.getElementById('profileEmergencyContact').value = user.emergency_contact || '';
            document.getElementById('profileOfficeAddress').value = user.office_address || '';
            
            // Schedule
            const scheduleDiv = document.getElementById('profileConsultationHours');
            if (user.consultation_hours) {
                scheduleDiv.innerHTML = user.consultation_hours;
            }
            
            // Statistics
            document.getElementById('profileTotalPatients').textContent = user.total_patients || '1,250';
            document.getElementById('profileTotalConsultations').textContent = user.total_consultations || '3,890';
            document.getElementById('profileRating').textContent = (user.rating || '4.8') + '/5.0';
            
            // Account Information
            document.getElementById('profileRegDate').textContent = user.registration_date || '15/06/2019';
            document.getElementById('profileLastLogin').textContent = user.last_login || 'Today at 9:15 AM';
        }

        function saveProfile() {
            // Get current data from database
            const currentUser = JSON.parse(localStorage.getItem('sahatak_doctor_data') || '{}');
            
            // Collect all profile data from form fields
            const updatedUser = {
                ...currentUser,
                // Professional Information
                experience: document.getElementById('profileExperience').value,
                hospital_affiliations: document.getElementById('profileHospitals').value,
                department: document.getElementById('profileDepartment').value,
                consultation_fee: document.getElementById('profileFee').value,
                education_details: document.getElementById('profileEducation').value,
                certifications: document.getElementById('profileCertifications').value,
                memberships: document.getElementById('profileMemberships').value,
                languages: document.getElementById('profileLanguages').value,
                consultation_areas: document.getElementById('profileConsultationAreas').value,
                // Contact Information
                office_phone: document.getElementById('profileOfficePhone').value,
                emergency_contact: document.getElementById('profileEmergencyContact').value,
                office_address: document.getElementById('profileOfficeAddress').value
            };
            
            // Save to database (localStorage)
            localStorage.setItem('sahatak_doctor_data', JSON.stringify(updatedUser));
            
            // Show success message
            alert('Profile updated successfully!');
            
            // Update verification status if profile is more complete
            updateVerificationStatus(updatedUser);
            
            console.log('Profile saved:', updatedUser);
        }

        function editProfile() {
            // This function is no longer needed since profile is directly editable
            // Just show a message that profile can be edited directly
            alert('You can now edit your profile information directly in the form above. Click "Save Profile" when done.');
        }

        function showSettings() {
            console.log('Show settings clicked');
            const settingsSection = document.getElementById('settings-section');
            const profileSection = document.getElementById('profile-section');
            
            // Hide profile if open
            profileSection.style.display = 'none';
            
            // Toggle settings
            settingsSection.style.display = settingsSection.style.display === 'none' ? 'block' : 'none';
            
            // Smooth scroll to settings section
            if (settingsSection.style.display === 'block') {
                settingsSection.scrollIntoView({ behavior: 'smooth' });
                loadUserSettings();
                
                // Update translations for settings section
                const currentLang = LanguageManager.getLanguage() || 'ar';
                const translations = LanguageManager.translations[currentLang];
                if (translations && translations.dashboard && translations.dashboard.doctor && translations.dashboard.doctor.settings) {
                    DashboardTranslations.updateProfileAndSettings(null, translations.dashboard.doctor.settings);
                }
            }
        }

        function hideSettings() {
            document.getElementById('settings-section').style.display = 'none';
        }

        function loadUserSettings() {
            // Load user settings from localStorage (simulating database)
            const user = JSON.parse(localStorage.getItem('sahatak_doctor_data') || '{}');
            
            // If no data exists, set default doctor values (simulating initial database load)
            if (!user.full_name) {
                user.full_name = 'Dr. Sarah Ahmed';
                user.email = 'sarah.ahmed@sahatak.com';
                user.phone = '+20 123 456 7890';
                user.medical_license = 'ML-2019-12345';
                user.specialization = 'internal-medicine';
                localStorage.setItem('sahatak_doctor_data', JSON.stringify(user));
            }
            
            // Populate form fields with current values from database
            document.getElementById('fullName').value = user.full_name || '';
            document.getElementById('email').value = user.email || '';
            document.getElementById('phone').value = user.phone || '';
            document.getElementById('medicalLicense').value = user.medical_license || '';
            document.getElementById('specialization').value = user.specialization || '';
            
            // Load preferences from database
            const preferences = JSON.parse(localStorage.getItem('sahatak_doctor_preferences') || '{}');
            document.getElementById('language').value = preferences.language || 'en';
            document.getElementById('emailNotifications').checked = preferences.email_notifications !== false;
            document.getElementById('smsNotifications').checked = preferences.sms_notifications !== false;
            document.getElementById('appointmentReminders').checked = preferences.appointment_reminders !== false;
        }

        function saveSettings() {
            // Get current data from database
            const currentUser = JSON.parse(localStorage.getItem('sahatak_doctor_data') || '{}');
            const currentPrefs = JSON.parse(localStorage.getItem('sahatak_doctor_preferences') || '{}');
            
            // Collect only changed fields
            const updatedUser = {
                ...currentUser,
                full_name: document.getElementById('fullName').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                medical_license: document.getElementById('medicalLicense').value,
                specialization: document.getElementById('specialization').value
            };
            
            // Update preferences
            const updatedPrefs = {
                language: document.getElementById('language').value,
                email_notifications: document.getElementById('emailNotifications').checked,
                sms_notifications: document.getElementById('smsNotifications').checked,
                appointment_reminders: document.getElementById('appointmentReminders').checked
            };
            
            // Save to database (localStorage)
            localStorage.setItem('sahatak_doctor_data', JSON.stringify(updatedUser));
            localStorage.setItem('sahatak_doctor_preferences', JSON.stringify(updatedPrefs));
            
            // Update displayed name in header if changed
            if (updatedUser.full_name && updatedUser.full_name !== currentUser.full_name) {
                document.getElementById('user-name').textContent = updatedUser.full_name;
            }
            
            // Show success message with which fields were updated
            const changedFields = [];
            if (currentUser.full_name !== updatedUser.full_name) changedFields.push('Name');
            if (currentUser.email !== updatedUser.email) changedFields.push('Email');
            if (currentUser.phone !== updatedUser.phone) changedFields.push('Phone');
            if (currentUser.medical_license !== updatedUser.medical_license) changedFields.push('Medical License');
            if (currentUser.specialization !== updatedUser.specialization) changedFields.push('Specialization');
            
            if (changedFields.length > 0) {
                alert(`Settings saved successfully!\nUpdated: ${changedFields.join(', ')}`);
            } else {
                alert('Settings saved successfully!');
            }
            
            console.log('Settings saved:', updatedUser, updatedPrefs);
            
            // Refresh profile section if it's open
            if (document.getElementById('profile-section').style.display !== 'none') {
                loadUserProfile();
            }
        }

        function resetSettings() {
            if (confirm('Are you sure you want to reload settings from database?')) {
                // Reload original values from database
                loadUserSettings();
                alert('Settings reloaded from database.');
            }
        }
        
        function changePassword() {
            alert('Password change functionality will redirect to secure password update page.');
        }
        
        function enableTwoFactor() {
            alert('Two-factor authentication setup will be implemented.');
        }
        
        function viewFullSchedule() {
            console.log('View full schedule clicked');
            window.location.href = '../medical/doctor/setAvailability.html';
        }
        
        function viewAllActivity() {
            console.log('View all activity clicked');
            // Implement view all activity
        }
        
        function viewAllMessages() {
            console.log('View all messages clicked');
            window.location.href = '../medical/doctor/comm-hub.html';
        }
        
        function toggleAvailability() {
            console.log('Toggle availability clicked');
            // Implement availability toggle
            const statusBtn = document.getElementById('availability-status');
            const icon = statusBtn.previousElementSibling;
            
            if (statusBtn.textContent === 'Available') {
                statusBtn.textContent = 'Unavailable';
                icon.className = 'bi bi-circle-fill text-danger me-1';
            } else {
                statusBtn.textContent = 'Available';
                icon.className = 'bi bi-circle-fill text-success me-1';
            }
        }
        
        function showLanguageSelector() {
            console.log('ðŸŒ Language selector clicked');
            // Toggle between Arabic and English
            const currentLang = LanguageManager.getLanguage() || 'ar';
            const newLang = currentLang === 'ar' ? 'en' : 'ar';
            console.log('ðŸ”„ Switching from', currentLang, 'to', newLang);
            
            // Change language
            LanguageManager.setLanguage(newLang);
            LanguageManager.applyLanguage(newLang);
            
            // Update dashboard translations (call after applyLanguage to ensure footer is properly updated)
            if (DashboardTranslations && DashboardTranslations.updateDoctorDashboard) {
                console.log('ðŸ“Š Calling updateDoctorDashboard with:', newLang);
                DashboardTranslations.updateDoctorDashboard(newLang);
            } else {
                console.log('âŒ DashboardTranslations not available');
            }
            
            // Update the language button text
            const langBtn = document.getElementById('current-lang');
            langBtn.textContent = newLang === 'ar' ? 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©' : 'English';
        }
        
        // logout function is now defined globally in main.js
        
        // File upload handler for profile documents
        function handleProfileFileUpload(event, statusId) {
            const file = event.target.files[0];
            const statusElement = document.getElementById(statusId);
            
            if (!file) {
                statusElement.innerHTML = '';
                return;
            }
            
            // Validate file size (5MB max)
            if (file.size > 5 * 1024 * 1024) {
                statusElement.innerHTML = '<small class="text-danger"><i class="bi bi-x-circle me-1"></i>File size must be less than 5MB</small>';
                event.target.value = '';
                return;
            }
            
            // Show success message
            statusElement.innerHTML = `<small class="text-success"><i class="bi bi-check-circle me-1"></i>${file.name} selected</small>`;
        }

        // Load dashboard statistics from API
        async function loadDoctorDashboardStats() {
            console.log('Loading doctor dashboard statistics...');
            
            try {
                // Load appointments to count scheduled ones
                const appointmentsResponse = await ApiHelper.makeRequest('/appointments/');
                
                if (appointmentsResponse.success) {
                    const appointments = appointmentsResponse.data.appointments;
                    
                    // Count scheduled/confirmed appointments (upcoming)
                    const scheduledCount = appointments.filter(apt => 
                        ['scheduled', 'confirmed'].includes(apt.status) && 
                        new Date(apt.appointment_date) > new Date()
                    ).length;
                    
                    // Count total patients (unique patient IDs from appointments)
                    const uniquePatientIds = [...new Set(appointments.map(apt => apt.patient_id))];
                    const totalPatients = uniquePatientIds.length;
                    
                    // Count completed appointments for consultation count
                    const completedCount = appointments.filter(apt => 
                        apt.status === 'completed'
                    ).length;
                    
                    // Update statistics in the doctor-stats-container
                    const statsContainer = document.getElementById('doctor-stats-container');
                    if (statsContainer) {
                        const currentLang = LanguageManager.getLanguage() || 'en';
                        
                        statsContainer.innerHTML = `
                            <div class="row text-center">
                                <div class="col-4">
                                    <div class="stat-item">
                                        <h3 class="stat-number text-primary">${scheduledCount}</h3>
                                        <p class="stat-label">${currentLang === 'ar' ? 'Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©' : 'Upcoming'}</p>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="stat-item">
                                        <h3 class="stat-number text-success">${totalPatients}</h3>
                                        <p class="stat-label">${currentLang === 'ar' ? 'Ø§Ù„Ù…Ø±Ø¶Ù‰' : 'Patients'}</p>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="stat-item">
                                        <h3 class="stat-number text-info">${completedCount}</h3>
                                        <p class="stat-label">${currentLang === 'ar' ? 'Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±Ø§Øª' : 'Consultations'}</p>
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                    
                    console.log(`Updated doctor stats - Upcoming: ${scheduledCount}, Patients: ${totalPatients}, Consultations: ${completedCount}`);
                } else {
                    console.warn('Failed to load appointments for stats:', appointmentsResponse.message);
                    // Set default values
                    const statsContainer = document.getElementById('doctor-stats-container');
                    if (statsContainer) {
                        const currentLang = LanguageManager.getLanguage() || 'en';
                        statsContainer.innerHTML = `
                            <div class="row text-center">
                                <div class="col-4">
                                    <div class="stat-item">
                                        <h3 class="stat-number text-primary">0</h3>
                                        <p class="stat-label">${currentLang === 'ar' ? 'Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©' : 'Upcoming'}</p>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="stat-item">
                                        <h3 class="stat-number text-success">0</h3>
                                        <p class="stat-label">${currentLang === 'ar' ? 'Ø§Ù„Ù…Ø±Ø¶Ù‰' : 'Patients'}</p>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="stat-item">
                                        <h3 class="stat-number text-info">0</h3>
                                        <p class="stat-label">${currentLang === 'ar' ? 'Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±Ø§Øª' : 'Consultations'}</p>
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                }
            } catch (error) {
                console.error('Error loading doctor dashboard stats:', error);
                // Set error state
                const statsContainer = document.getElementById('doctor-stats-container');
                if (statsContainer) {
                    const currentLang = LanguageManager.getLanguage() || 'en';
                    const errorMsg = currentLang === 'ar' ? 'Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª' : 'Error loading statistics';
                    statsContainer.innerHTML = `
                        <div class="text-center">
                            <p class="text-muted">${errorMsg}</p>
                        </div>
                    `;
                }
            }
        }
        
        // Refresh doctor dashboard statistics - can be called from other pages
        window.refreshDoctorDashboardStats = function() {
            console.log('Refreshing doctor dashboard statistics...');
            loadDoctorDashboardStats();
        };

        // Initialize doctor dashboard on page load
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('Doctor dashboard initializing...');
            await DashboardTranslations.initializeDashboard('doctor');
            
            // Load and update user data including verification status
            const user = AuthGuard.getCurrentUser();
            if (user && user.full_name) {
                // Update user name in header only if we have the actual name
                document.getElementById('user-name').textContent = user.full_name;
                
                // Update verification status from database
                updateVerificationStatus(user);
            } else {
                // Keep showing "Loading..." if user data is not available
                console.log('User data not available yet');
                // For unverified doctors or users without data, disable actions
                disableDashboardActions();
            }
            
            // Try to get fresh user data from API with cache-busting
            try {
                const response = await ApiHelper.makeRequest('/users/profile?t=' + Date.now());
                if (response.success && response.user) {
                    const apiUser = response.user;
                    
                    // Update display elements
                    if (apiUser.full_name) {
                        document.getElementById('user-name').textContent = apiUser.full_name;
                    }
                    
                    // Check doctor profile for verification status
                    let isVerified = false;
                    if (apiUser.profile && apiUser.profile.is_verified !== undefined) {
                        // Use profile verification status if available
                        isVerified = apiUser.profile.is_verified === true;
                        apiUser.is_verified = isVerified; // Set on user object for consistency
                    } else if (apiUser.is_verified !== undefined) {
                        // Fallback to user-level verification
                        isVerified = apiUser.is_verified === true;
                    }
                    
                    console.log('Fresh API data - is_verified:', isVerified, 'API User:', apiUser);
                    
                    // Update verification status with fresh data
                    updateVerificationStatus(apiUser);
                    
                    // Update localStorage for consistency
                    localStorage.setItem('currentUser', JSON.stringify(apiUser));
                    localStorage.setItem('sahatak_doctor_data', JSON.stringify(apiUser));
                }
            } catch (error) {
                console.log('Could not fetch fresh user data:', error);
                // If API call fails, still disable actions for safety
                if (!user || (!user.is_verified && user.verification_status !== 'verified')) {
                    disableDashboardActions();
                }
            }
            
            // Initialize dashboard data loading only if verified
            const finalUser = AuthGuard.getCurrentUser();
            const isVerified = finalUser && (finalUser.is_verified === true || finalUser.verification_status === 'verified');
            
            if (isVerified && window.Dashboard && Dashboard.initialize) {
                await Dashboard.initialize();
            }
            
            // Load dashboard statistics after translations are loaded
            setTimeout(() => {
                loadDoctorDashboardStats();
            }, 1000); // Small delay to ensure API is ready
        });
    </script>
</body>
</html>